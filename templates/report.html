<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="author" content="colorlib.com">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,900|Poppins:700" rel="stylesheet" />
    <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='css/fontawesome-5.14.0/all.min.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='css/spinner/main.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='css/googlemaps/main.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='css/popup-images/main.css') }}" rel="stylesheet" />
  </head>

  <body>
    <div class="s012">
      <div id="spinner" class="loadingio-spinner-pulse-dunz37hlstn">
        <div class="ldio-cf71dy4a5vv">
          <div></div>
          <div></div>
          <div></div>
      </div>
    </div>
 
    <form id="form" method="POST" action="{{ url_for('report') }}">
      <fieldset>
        <legend>台北市政府消防局救災救護指揮中心</legend>
      </fieldset>
      <div class="inner-form" id="inner-form">
        <header id="header">
          <div class="travel-type-wrap">
            <div class="item active">
              <div class="group-icon">
                <i class="fas fa-user-injured"></i>
              </div>
              <span>事故派遣</span>
            </div>
            <div class="item">
              <div class="group-icon">
                <i class="fas fa-ambulance"></i>
              </div>
              <span>醫院派遣</span>
            </div>
            <div class="item">
              <div class="group-icon">
                <i class="fas fa-fire"></i>
              </div>
              <span>消防派遣</span>
            </div>
          </div>
        </header>

        <div class="main-form" id="main-form">
          <div class="row">
            <div class="input-wrap">
              <div class="icon-wrap">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path>
                </svg>
              </div>
              <div class="input-field">
                <label>事發點</label>
                <input id="pac-input" type="text" placeholder="搜尋地址" name="location" required/>
                <div id="map"></div>
              </div>
            </div>
          </div>
          <div class="row last">
            <button class="btn-search" type="submit">建立案件</button>
          </div>
        </div>

        <div class="main-form" id="hospital-form">
          <div class="row">
            <div class="input-wrap">
              <div class="icon-wrap">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path>
                </svg>
              </div>
              <div class="input-field">
                <label>任務編號</label>
                <input id="taskId" type="text" value="2020-08-15-A0001" style="color:green" readonly/>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="input-wrap">
              <div class="icon-wrap">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path>
                </svg>
              </div>
              <div class="input-field">
                <label>事故點</label>
                <input id="accident_location" type="text" value="" style="color:green" readonly/>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="input-wrap">
              <div class="icon-wrap">
                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path>
                </svg> -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path d="M8.627,7.885C8.499,8.388,7.873,8.101,8.13,8.177L4.12,7.143c-0.218-0.057-0.351-0.28-0.293-0.498c0.057-0.218,0.279-0.351,0.497-0.294l4.011,1.037C8.552,7.444,8.685,7.667,8.627,7.885 M8.334,10.123L4.323,9.086C4.105,9.031,3.883,9.162,3.826,9.38C3.769,9.598,3.901,9.82,4.12,9.877l4.01,1.037c-0.262-0.062,0.373,0.192,0.497-0.294C8.685,10.401,8.552,10.18,8.334,10.123 M7.131,12.507L4.323,11.78c-0.218-0.057-0.44,0.076-0.497,0.295c-0.057,0.218,0.075,0.439,0.293,0.495l2.809,0.726c-0.265-0.062,0.37,0.193,0.495-0.293C7.48,12.784,7.35,12.562,7.131,12.507M18.159,3.677v10.701c0,0.186-0.126,0.348-0.306,0.393l-7.755,1.948c-0.07,0.016-0.134,0.016-0.204,0l-7.748-1.948c-0.179-0.045-0.306-0.207-0.306-0.393V3.677c0-0.267,0.249-0.461,0.509-0.396l7.646,1.921l7.654-1.921C17.91,3.216,18.159,3.41,18.159,3.677 M9.589,5.939L2.656,4.203v9.857l6.933,1.737V5.939z M17.344,4.203l-6.939,1.736v9.859l6.939-1.737V4.203z M16.168,6.645c-0.058-0.218-0.279-0.351-0.498-0.294l-4.011,1.037c-0.218,0.057-0.351,0.28-0.293,0.498c0.128,0.503,0.755,0.216,0.498,0.292l4.009-1.034C16.092,7.085,16.225,6.863,16.168,6.645 M16.168,9.38c-0.058-0.218-0.279-0.349-0.498-0.294l-4.011,1.036c-0.218,0.057-0.351,0.279-0.293,0.498c0.124,0.486,0.759,0.232,0.498,0.294l4.009-1.037C16.092,9.82,16.225,9.598,16.168,9.38 M14.963,12.385c-0.055-0.219-0.276-0.35-0.495-0.294l-2.809,0.726c-0.218,0.056-0.351,0.279-0.293,0.496c0.127,0.506,0.755,0.218,0.498,0.293l2.807-0.723C14.89,12.825,15.021,12.603,14.963,12.385"></path>
                </svg>
              </div>
              <div class="input-field">
                <label>醫院</label>
                <input id="injure-table" type="text" placeholder="檢傷分類表"/>
                <div id="map"></div>
              </div>
            </div>
          </div>
          <div class="row last">
            <button class="btn-search" type="button" id="btn-hospital">選擇後送醫院</button>
          </div>
        </div>

        <div class="main-form" id="return-form">
          <div class="row">
            <div class="input-wrap">
              <div class="icon-wrap">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path>
                </svg>
              </div>
              <div class="input-field">
                <label>任務編號</label>
                <input id="taskId" type="text" value="2020-08-15-A0001" style="color:green" readonly/>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="input-wrap">
              <div class="icon-wrap">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path>
                </svg>
              </div>
              <div class="input-field">
                <label>派遣單位</label>
                <input id="departure" type="text" value="" style="color:green" readonly/>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="input-wrap">
              <div class="icon-wrap">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path>
                </svg>
              </div>
              <div class="input-field">
                <label>駕駛員</label>
                <input id="driver" type="text" value="" style="color:green" readonly/>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="input-wrap">
              <div class="icon-wrap">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path>
                </svg>
              </div>
              <div class="input-field">
                <label>聯絡電話</label>
                <input id="driver-phone" type="text" value="" style="color:green" readonly/>
              </div>
            </div>
          </div>
      </div>

      <div class="main-form" id="return-form-hospital">
        <div class="row">
          <div class="input-wrap">
            <div class="icon-wrap">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path>
              </svg>
            </div>
            <div class="input-field">
              <label>任務編號</label>
              <input id="taskId-hospital-return" type="text" value="2020-08-15-A0001" style="color:green" readonly/>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="input-wrap">
            <div class="icon-wrap">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path>
              </svg>
            </div>
            <div class="input-field">
              <label>派送醫院</label>
              <input id="departure-hospital" type="text" value="臺北市立聯合醫院仁愛院區" style="color:green" readonly/>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="input-wrap">
            <div class="icon-wrap">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path>
              </svg>
            </div>
            <div class="input-field">
              <label>駕駛員</label>
              <input id="driver-hospital" type="text" value="王大明" style="color:green" readonly/>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="input-wrap">
            <div class="icon-wrap">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path>
              </svg>
            </div>
            <div class="input-field">
              <label>聯絡電話</label>
              <input id="driver-phone-hospital" type="text" value="0987123456" style="color:green" readonly/>
            </div>
          </div>
        </div>
    </div>
    </div>
  </form>
</div>

<img id="myImg" src="{{ url_for('static', filename='images/injure-table.png') }}" alt="Snow" style="width:100%;max-width:300px" hidden>

<!-- The Modal -->
<div id="myModal" class="modal">
  <span class="close">&times;</span>
  <img class="modal-content" id="img01">
  <div id="caption"></div>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBwtdq49i3xXYOiYPkGYRwB4Z2mC4Th-m4&callback=initAutocomplete&libraries=places&v=weekly" defer></script>
<script src="{{ url_for('static', filename='js/googlemaps/main.js') }}"></script>
<script src="{{ url_for('static', filename='js/extension/flatpickr.js') }}"></script>
<script src="{{ url_for('static', filename='js/popup-images/main.js') }}"></script>
<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous">
</script>
<script>  
  $("#spinner").hide();
  $('#return-form').hide();
  $('#return-form-hospital').hide();
  $('#hospital-form').hide();

  $("#form").on("submit", function(e){
    e.preventDefault();
    
    //save searching record to cookie
    var data = $("form").serializeArray();

    // animation
    $("#header").hide();
    $("#main-form").hide();
    $("#inner-form").height(300);
    $("#spinner").show();

    var title = $('#form').find('legend');

    // new title
    title.css('text-align', 'center');
    title.hide().text("路線計算中");
    title.show(2000).promise().then(function(){
        $.ajax({
          url : "{{ url_for('report') }}",
          type : "POST",
          data : data
        }).done(function(data){
          console.log("success");
          document.cookie = "accident_address="+data['accident_address'];
          document.cookie = "accident_location_lat="+data['accident_location'][0];
          document.cookie = "accident_location_lng="+data['accident_location'][1];

          $("#spinner").hide();
          title.css('text-align', 'left');
          title.hide().text("任務已派發");
        }).fail(function(){
          console.log("fail");

          $("#spinner").hide();
          title.css('text-align', 'left');
          title.hide().text("任務已派發");
          
        }).always(function(data){
          title.show(2000).promise().then(function(){
            $("#departure").val(data['firestation']);
            $("#driver").val("王大明");
            $("#driver-phone").val("0987123456");
            $("#return-form").show();
          });
        });
    });
  });

  $('#btn-hospital').click(function(){
    $("#header").hide();
    $("#hospital-form").hide();
    $("#inner-form").height(300);
    $("#spinner").show();

    var title = $('#form').find('legend');

    // new title
    title.css('text-align', 'center');
    title.hide().text("路線計算中");

    title.show(2000).promise().then(function(){
      console.log("success (hospital)");

      $("#spinner").hide();
      title.css('text-align', 'left');
      title.hide().text("任務已派發");
      title.show(2000).promise().then(function(){
        $("#return-form-hospital").show();
      })
    });
  });
</script>
<script>
  function getCookie(cname) {
    var name = cname + "=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var ca = decodedCookie.split(';');
    for(var i = 0; i <ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
  }

  flatpickr(".datepicker",
  {
    dateFormat: "m/d/y"
  });
  var btnTypes = document.querySelectorAll('.travel-type-wrap .item')
  for (let i = 0; i < btnTypes.length; i++)
  {
    btnTypes[i].addEventListener('click', function()
    {
      for (let i = 0; i < btnTypes.length; i++)
      {
        btnTypes[i].classList.remove('active')
      }
      btnTypes[i].classList.add('active')
      if (btnTypes[i].firstElementChild.nextElementSibling.innerHTML == "事故派遣"){
        $("#hospital-form").hide();
        $("#main-form").show();
        
      } else if (btnTypes[i].firstElementChild.nextElementSibling.innerHTML == "醫院派遣"){
        $("#main-form").hide();

        var lat = getCookie("accident_location_lat");
        var lng = getCookie("accident_location_lng");
        var address = getCookie("accident_address");
        var str = address + "(" + lat+", "+lng + ")";

        $("#accident_location").val(str);
        $("#hospital-form").show();
      }
    })
  }


</script>
</body><!-- This templates was made by Colorlib (https://colorlib.com) -->
</html>
